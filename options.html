<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>WordClick Dictionary Settings</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
    .nav { background: #f5f5f5; padding: 10px; border-bottom: 1px solid #ddd; }
    .nav button { margin-right: 10px; padding: 8px 16px; background: white; border: 1px solid #ddd; cursor: pointer; }
    .nav button.active { background: #007bff; color: white; border-color: #007bff; }
    .page { display: none; padding: 20px; }
    .page.active { display: block; }
    input[type="file"] { margin: 5px 0; }
    button { margin: 10px 0; padding: 8px; cursor: pointer; }
    #status { margin-top: 10px; padding: 10px; border-radius: 4px; }
    .success { background: #d4edda; color: #155724; }
    .error { background: #f8d7da; color: #721c24; }
    .info { background: #d1ecf1; color: #0c5460; }
    .query-group { border: 1px solid #ddd; padding: 10px; margin: 10px 0; border-radius: 4px; }
    .query-group h4 { margin-top: 0; }
    .icon-selector { display: flex; gap: 5px; flex-wrap: wrap; margin: 10px 0; }
    .icon-option { padding: 5px; border: 1px solid #ddd; cursor: pointer; border-radius: 3px; }
    .icon-option.selected { background: #007bff; color: white; }
    .form-group { margin: 10px 0; }
    .form-group .lPrompt { display: block; }
    .form-group #aiPrompt { width: 300px; height: 300px;}
    .form-group label { margin-bottom: 5px; }
    .form-group input, .form-group select { padding: 5px; }
  </style>
</head>
<body>
  <div class="nav">
    <button id="nav-main" class="active">Main Settings</button>
    <button id="nav-import">Import Dictionary</button>
    <button id="nav-groups">Query Groups</button>
    <button id="nav-backup">Backup/Restore</button>
  </div>

  <!-- Main Settings Page -->
  <div id="page-main" class="page active">
    <h2>Main Settings</h2>

    <h3>Appearance</h3>
    <label>
      <input type="checkbox" id="darkModeCheckbox" />
      Enable dark mode for dictionary popup
    </label>
    <br>
    <label>
      <input type="checkbox" id="hideGroupNamesCheckbox" />
      Hide query group names in results (show only icons)
    </label>

    <h4>Translation Settings</h4>
    <div class="form-group">
      <label for="targetLanguage">Target Language: </label>
      <select id="targetLanguage">
        <option value="en">English</option>
        <option value="es">Spanish</option>
        <option value="fr">French</option>
        <option value="de">German</option>
        <option value="it">Italian</option>
        <option value="pt">Portuguese</option>
        <option value="ru">Russian</option>
        <option value="ja">Japanese</option>
        <option value="ko">Korean</option>
        <option value="zh">Chinese</option>
        <option value="ar">Arabic</option>
        <option value="hi">Hindi</option>
        <option value="bn">Bengali</option>
        <option value="pa">Punjabi</option>
        <option value="jv">Javanese</option>
        <option value="th">Thai</option>
        <option value="vi">Vietnamese</option>
        <option value="tr">Turkish</option>
        <option value="pl">Polish</option>
        <option value="nl">Dutch</option>
        <option value="sv">Swedish</option>
        <option value="da">Danish</option>
        <option value="no">Norwegian</option>
        <option value="fi">Finnish</option>
        <option value="he">Hebrew</option>
        <option value="el">Greek</option>
        <option value="cs">Czech</option>
        <option value="hu">Hungarian</option>
        <option value="ro">Romanian</option>
        <option value="sk">Slovak</option>
        <option value="hr">Croatian</option>
        <option value="sl">Slovenian</option>
      </select>
    </div>

    <h4>Query Button Placement</h4>
    <div class="form-group">
      <label for="iconPlacement">Placement: </label>
      <select id="iconPlacement">
        <option value="right">Right</option>
        <option value="left">Left</option>
        <option value="word">Word (default)</option>
      </select>
    </div>
    <div class="form-group">
      <label for="iconOffset">Vertical offset (px): </label>
      <input type="number" id="iconOffset" placeholder="-50" value="50">
    </div>
    <div class="form-group">
      <label for="iconSpacing">Space between icons (px): </label>
      <input type="number" id="iconSpacing" placeholder="10" value="10" min="5" max="50">
    </div>

    <h4>Touch Gestures</h4>
    <div class="form-group">
      <label for="rightSwipeGroup">Right swipe executes: </label>
      <select id="rightSwipeGroup">
        <option value="">None</option>
        <!-- Query groups will be loaded here -->
      </select>
    </div>

    <h4>Mouse Gestures</h4>
    <div class="form-group">
      <label for="tripleClickGroup">Triple click executes: </label>
      <select id="tripleClickGroup">
        <option value="">None</option>
        <!-- Query groups will be loaded here -->
      </select>
    </div>
  </div>

  <!-- Import Dictionary Page -->
  <div id="page-import" class="page">
    <h2>Import Dictionary</h2>

    <h3>Upload StarDict Dictionary</h3>
    <p>Select the .ifo file (other files will be auto-selected):</p>
    <input type="file" id="filesInput" multiple accept=".ifo,.idx,.dict,.gz,.dz,.syn" />
    <br>
    <button id="uploadBtn">Upload & Validate</button>
    <div id="status"></div>

    <h3>Loaded Dictionaries</h3>
    <button id="checkDictsBtn">Check Dicts</button>
    <div id="dictList"></div>
  </div>

  <!-- Query Groups Page -->
  <div id="page-groups" class="page">
    <h2>Query Groups</h2>

    <button id="addGroupBtn">Add Query Group</button>

    <!-- Query Group Form (hidden by default) -->
    <div id="groupForm" style="display: none; margin: 20px 0; border: 1px solid #ddd; padding: 20px; border-radius: 4px; background: #f9f9f9;">
      <h3 id="formTitle">Add Query Group</h3>

      <div class="form-group">
        <label for="groupName">Group Name:</label>
        <input type="text" id="groupName" required>
      </div>

      <div class="form-group">
        <label>Icon:</label>
        <div class="icon-selector" id="iconSelector">
          <div class="icon-option" data-icon="#">#</div>
          <div class="icon-option" data-icon="üîç">üîç</div>
          <div class="icon-option" data-icon="üìñ">üìñ</div>
          <div class="icon-option" data-icon="ü§ñ">ü§ñ</div>
          <div class="icon-option" data-icon="üåê">üåê</div>
          <div class="icon-option" data-icon="üìö">üìö</div>
          <div class="icon-option" data-icon="üí°">üí°</div>
          <div class="icon-option" data-icon="üéØ">üéØ</div>
          <div class="icon-option" data-icon="icon_Google_Translate.png"><img src="icon_Google_Translate.png" style="width: 16px; height: 16px;" alt="GT"></div>
          <div class="icon-option" data-icon="icon_gemini.png"><img src="icon_gemini.png" style="width: 16px; height: 16px;" alt="Gemini"></div>
          <input type="text" id="customIcon" placeholder="Or enter custom icon/text" style="margin-left: 10px; width: 150px;">
        </div>
      </div>

      <div class="form-group">
        <label for="queryType">Query Type:</label>
        <select id="queryType">
          <option value="offline">Offline (StarDict)</option>
          <option value="web">Web API</option>
          <option value="google_translate">Google Translate</option>
          <option value="ai">AI Service</option>
        </select>
      </div>

      <div class="form-group">
        <label for="displayMethod">Display Method:</label>
        <select id="displayMethod">
          <option value="popup">Popup (floating box)</option>
          <option value="inline">Inline (below selected text)</option>
          <option value="bottom">Bottom panel (full width)</option>
        </select>
      </div>

      <!-- Popup Settings (only shown when display method is popup) -->
      <div id="popupSettings" class="query-type-settings" style="display: none;">
        <div class="form-group">
          <label for="popupWidth">Popup Width (px or %):</label>
          <input type="text" id="popupWidth" placeholder="40%" value="40%">
          <small>Width of popup window (e.g., "400px" or "40%")</small>
        </div>
        <div class="form-group">
          <label for="popupHeight">Popup Height (px or %):</label>
          <input type="text" id="popupHeight" placeholder="30%" value="30%">
          <small>Height of popup window (e.g., "200px" or "30%")</small>
        </div>
        <div class="form-group">
          <label>
            <input type="checkbox" id="popupHideOnClickOutside" />
            Hide popup when clicking outside
          </label>
        </div>
      </div>

      <!-- Inline Settings (only shown when display method is inline) -->
      <div id="inlineSettings" class="query-type-settings" style="display: none;">
        <div class="form-group">
          <label>
            <input type="checkbox" id="inlineFlexibleHeight" checked />
            Flexible height (grows with content, otherwise shows scrollbars)
          </label>
        </div>
      </div>

      <div class="form-group">
        <label for="textSelectionMethod">Text Selection Method:</label>
        <select id="textSelectionMethod">
          <option value="selectedText">Selected text</option>
          <option value="wholeWord">Whole word</option>
          <option value="wholeParagraph">Whole paragraph</option>
        </select>
      </div>

      <div class="form-group">
        <label for="showSearchField">Show Search Field:</label>
        <select id="showSearchField">
          <option value="none">None</option>
          <option value="liveResults">Live results</option>
          <option value="liveHeadwordResults">Live results + suggestions (only offline dicts)</option>
          <option value="onPressingEnter">On pressing enter</option>
        </select>
      </div>

      <!-- Offline Settings -->
      <div id="offlineSettings" class="query-type-settings">
        <p>This group will use the selected StarDict dictionaries.</p>
        <div class="form-group">
          <label>Available Dictionaries:</label>
          <div id="dictionarySelection" style="max-height: 200px; overflow-y: auto; border: 1px solid #ddd; padding: 10px; border-radius: 4px; background: white;">
            <!-- Dictionary checkboxes will be loaded here -->
            <p style="color: #666; font-style: italic;">Loading dictionaries...</p>
          </div>
        </div>
      </div>

      <!-- Web API Settings -->
      <div id="webSettings" class="query-type-settings" style="display: none;">
        <div class="form-group">
          <label for="webUrl">API URL:</label>
          <input type="url" id="webUrl" placeholder="https://api.example.com/lookup?word={text}">
          <small>Use {text} for selected text, {lang} for full language name, {lang_short} for 2-letter code</small>
          <br><small>Examples:</small>
          <br><small>‚Ä¢ Dictionary API: https://api.dictionaryapi.dev/api/v2/entries/{lang_short}/{text}</small>
          <br><small>‚Ä¢ Translation API: https://translate.googleapis.com/translate_a/single?client=gtx&sl=auto&tl={lang_short}&dt=t&q={text}</small>
        </div>
        <div class="form-group">
          <label for="webJsonPath">JSON Path (optional):</label>
          <input type="text" id="webJsonPath" placeholder="data.translation or 0[0][1]">
          <small>Extract specific data from JSON response (e.g., 'result.translation' or 'data[0].text')</small>
        </div>
      </div>

      <!-- AI Settings -->
      <div id="aiSettings" class="query-type-settings" style="display: none;">
        <div class="form-group">
          <label for="aiProvider">AI Provider:</label>
          <select id="aiProvider">
            <option value="openai">OpenAI</option>
            <option value="anthropic">Anthropic</option>
            <option value="google">Google AI</option>
          </select>
        </div>
        <div class="form-group">
          <label for="aiApiKey">API Key:</label>
          <input type="password" id="aiApiKey" required>
        </div>
        <div class="form-group">
          <label for="aiModel">Model:</label>
          <input type="text" id="aiModel" placeholder="gpt-3.5-turbo" required>
        </div>
        <div class="form-group">
          <label for="aiMaxTokens">Max Tokens:</label>
          <input type="number" id="aiMaxTokens" placeholder="2048" value="2048" min="1" max="10000">
          <small>Maximum number of tokens to generate in the response</small>
        </div>
        <div class="form-group">
          <label class="lPrompt" for="aiPrompt">Prompt Template:</label>
          <textarea id="aiPrompt" rows="3" placeholder="You are a Tutor, give a grammar breakdown for: {text}">You are a Tutor, give a grammar breakdown for: {text}</textarea>
        </div>
      </div>

      <div style="margin-top: 20px;">
        <button id="saveGroupBtn">Save Group</button>
        <button id="cancelGroupBtn">Cancel</button>
      </div>
    </div>

    <div id="groupsList">
      <!-- Query groups will be loaded here -->
    </div>
  </div>

  <!-- Backup/Restore Page -->
  <div id="page-backup" class="page">
    <h2>Backup/Restore</h2>

    <h3>Settings Backup</h3>
    <p>Export your settings to a file or import settings from a backup file.</p>
    <button id="exportSettingsBtn">Export Settings</button>
    <br>
    <input type="file" id="importSettingsFile" accept=".json" style="display: none;">
    <button id="importSettingsBtn">Import Settings</button>
    <div id="settingsStatus"></div>

    <h3>Dictionary Backup</h3>
    <p>Export your dictionaries in Yomitan-compatible format or import dictionaries from Yomitan.</p>
    <button id="exportDictBtn">Export Dictionaries</button>
    <br>
    <input type="file" id="importDictFile" accept=".zip,.json" style="display: none;">
    <button id="importDictBtn">Import Dictionaries</button>
    <div id="dictStatus"></div>

    <h3>Full Backup</h3>
    <p>Export both settings and dictionaries in a single backup file.</p>
    <button id="exportAllBtn">Export Everything</button>
    <br>
    <input type="file" id="importAllFile" accept=".json" style="display: none;">
    <button id="importAllBtn">Import Everything</button>
    <div id="fullBackupStatus"></div>
  </div>

  <script src="pako.min.js"></script>
  <script src="structured-db.js"></script>
  <script src="parser.js"></script>
  <script src="options.js"></script>
</body>
</html>
