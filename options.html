<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>WordClick Dictionary Settings</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
    .nav { background: #f5f5f5; padding: 10px; border-bottom: 1px solid #ddd; }
    .nav button { margin-right: 10px; padding: 8px 16px; background: white; border: 1px solid #ddd; cursor: pointer; }
    .nav button.active { background: #007bff; color: white; border-color: #007bff; }
    .page { display: none; padding: 20px; }
    .page.active { display: block; }
    input[type="file"] { margin: 5px 0; }
    button { margin: 10px 0; padding: 8px; cursor: pointer; }
    #status { margin-top: 10px; padding: 10px; border-radius: 4px; }
    .success { background: #d4edda; color: #155724; }
    .error { background: #f8d7da; color: #721c24; }
    .info { background: #d1ecf1; color: #0c5460; }
    .query-group { border: 1px solid #ddd; padding: 10px; margin: 10px 0; border-radius: 4px; }
    .query-group h4 { margin-top: 0; }
    .icon-selector { display: flex; gap: 5px; flex-wrap: wrap; margin: 10px 0; }
    .icon-option { padding: 5px; border: 1px solid #ddd; cursor: pointer; border-radius: 3px; }
    .icon-option.selected { background: #007bff; color: white; }
    .form-group { margin: 10px 0; }
    .form-group label { margin-bottom: 5px; }
    .form-group input, .form-group select { padding: 5px; }
  </style>
</head>
<body>
  <div class="nav">
    <button id="nav-main" class="active">Main Settings</button>
    <button id="nav-import">Import Dictionary</button>
    <button id="nav-groups">Query Groups</button>
  </div>

  <!-- Main Settings Page -->
  <div id="page-main" class="page active">
    <h2>Main Settings</h2>

    <h3>Appearance</h3>
    <label>
      <input type="checkbox" id="darkModeCheckbox" />
      Enable dark mode for dictionary popup
    </label>

    <h4>Query Button Placement</h4>
    <div class="form-group">
      <label for="iconPlacement">Placement: </label>
      <select id="iconPlacement">
        <option value="right">Right</option>
        <option value="left">Left</option>
        <option value="word">Word (default)</option>
      </select>
    </div>
    <div class="form-group">
      <label for="iconOffset">Vertical offset (px): </label>
      <input type="number" id="iconOffset" placeholder="-50" value="50">
    </div>
    <div class="form-group">
      <label for="iconSpacing">Space between icons (px): </label>
      <input type="number" id="iconSpacing" placeholder="10" value="10" min="5" max="50">
    </div>
  </div>

  <!-- Import Dictionary Page -->
  <div id="page-import" class="page">
    <h2>Import Dictionary</h2>

    <h3>Upload StarDict Dictionary</h3>
    <p>Select the .ifo file (other files will be auto-selected):</p>
    <input type="file" id="filesInput" multiple accept=".ifo,.idx,.dict,.gz,.dz,.syn" />
    <br>
    <button id="uploadBtn">Upload & Validate</button>
    <div id="status"></div>

    <h3>Loaded Dictionaries</h3>
    <button id="checkDictsBtn">Check Dicts</button>
    <div id="dictList"></div>
  </div>

  <!-- Query Groups Page -->
  <div id="page-groups" class="page">
    <h2>Query Groups</h2>

    <button id="addGroupBtn">Add Query Group</button>

    <!-- Query Group Form (hidden by default) -->
    <div id="groupForm" style="display: none; margin: 20px 0; border: 1px solid #ddd; padding: 20px; border-radius: 4px; background: #f9f9f9;">
      <h3 id="formTitle">Add Query Group</h3>

      <div class="form-group">
        <label for="groupName">Group Name:</label>
        <input type="text" id="groupName" required>
      </div>

      <div class="form-group">
        <label>Icon:</label>
        <div class="icon-selector" id="iconSelector">
          <div class="icon-option" data-icon="#">#</div>
          <div class="icon-option" data-icon="üîç">üîç</div>
          <div class="icon-option" data-icon="üìñ">üìñ</div>
          <div class="icon-option" data-icon="ü§ñ">ü§ñ</div>
          <div class="icon-option" data-icon="üåê">üåê</div>
          <div class="icon-option" data-icon="üìö">üìö</div>
          <div class="icon-option" data-icon="üí°">üí°</div>
          <div class="icon-option" data-icon="üéØ">üéØ</div>
        </div>
      </div>

      <div class="form-group">
        <label for="queryType">Query Type:</label>
        <select id="queryType">
          <option value="offline">Offline (StarDict)</option>
          <option value="web">Web API</option>
          <option value="ai">AI Service</option>
        </select>
      </div>

      <!-- Offline Settings -->
      <div id="offlineSettings" class="query-type-settings">
        <p>This group will use the selected StarDict dictionaries.</p>
        <div class="form-group">
          <label>Available Dictionaries:</label>
          <div id="dictionarySelection" style="max-height: 200px; overflow-y: auto; border: 1px solid #ddd; padding: 10px; border-radius: 4px; background: white;">
            <!-- Dictionary checkboxes will be loaded here -->
            <p style="color: #666; font-style: italic;">Loading dictionaries...</p>
          </div>
        </div>
      </div>

      <!-- Web API Settings -->
      <div id="webSettings" class="query-type-settings" style="display: none;">
        <div class="form-group">
          <label for="webUrl">API URL:</label>
          <input type="url" id="webUrl" placeholder="https://api.example.com/lookup?word={word}">
          <small>Use {word} or {text} as placeholder for the selected word</small>
          <br><small>Examples:</small>
          <br><small>‚Ä¢ Dictionary API: https://api.dictionaryapi.dev/api/v2/entries/en/{word}</small>
          <br><small>‚Ä¢ Translation API: https://api.mymemory.translated.net/get?q={text}&langpair=en|es</small>
        </div>
        <div class="form-group">
          <label for="webApiKey">API Key (optional):</label>
          <input type="password" id="webApiKey">
        </div>
      </div>

      <!-- AI Settings -->
      <div id="aiSettings" class="query-type-settings" style="display: none;">
        <div class="form-group">
          <label for="aiProvider">AI Provider:</label>
          <select id="aiProvider">
            <option value="openai">OpenAI</option>
            <option value="anthropic">Anthropic</option>
            <option value="google">Google AI</option>
          </select>
        </div>
        <div class="form-group">
          <label for="aiApiKey">API Key:</label>
          <input type="password" id="aiApiKey" required>
        </div>
        <div class="form-group">
          <label for="aiModel">Model:</label>
          <input type="text" id="aiModel" placeholder="gpt-3.5-turbo" required>
        </div>
        <div class="form-group">
          <label for="aiPrompt">Prompt Template:</label>
          <textarea id="aiPrompt" rows="3" placeholder="Define the meaning of: {word}">Define the meaning of: {word}</textarea>
        </div>
      </div>

      <div style="margin-top: 20px;">
        <button id="saveGroupBtn">Save Group</button>
        <button id="cancelGroupBtn">Cancel</button>
      </div>
    </div>

    <div id="groupsList">
      <!-- Query groups will be loaded here -->
    </div>
  </div>

  <script src="pako.min.js"></script>
  <script src="structured-db.js"></script>
  <script src="parser.js"></script>
  <script src="options.js"></script>
</body>
</html>
